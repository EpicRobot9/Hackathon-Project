{% extends 'base.html' %}

{% block title %}Create Flash Cards{% endblock %}

{% block content %}
<div class="container">
    <div class="header-section">
        <h1>Create Flash Card Set</h1>
        <a href="/study-tools/flashcards" class="btn btn-secondary">Back to Flash Cards</a>
    </div>

    <form id="flashcard-form" class="flashcard-creation-form">
        <div class="form-section">
            <label for="set-name">Flash Card Set Name:</label>
            <input type="text" id="set-name" name="set_name" required placeholder="e.g., Biology Chapter 5" class="form-control">
        </div>

        <div class="form-section">
            <label for="content-source">Content Source:</label>
            <select id="content-source" name="content_source" class="form-control" onchange="toggleContentInput()">
                <option value="text">Manual Text Input</option>
                <option value="file">Upload File</option>
                <option value="assignment">From Assignment</option>
            </select>
        </div>

        <!-- Text Input Section -->
        <div id="text-input-section" class="form-section">
            <label for="content-text">Paste your study content:</label>
            <textarea id="content-text" name="content_text" rows="10" placeholder="Paste your notes, textbook content, or study material here..." class="form-control"></textarea>
        </div>

        <!-- File Upload Section -->
        <div id="file-input-section" class="form-section" style="display: none;">
            <label for="content-file">Upload Study Material:</label>
            <input type="file" id="content-file" name="content_file" accept=".txt,.pdf,.doc,.docx" class="form-control">
            <small class="form-help">Supported formats: TXT, PDF, DOC, DOCX</small>
        </div>

        <!-- Assignment Selection -->
        <div id="assignment-input-section" class="form-section" style="display: none;">
            <label for="assignment-select">Select Assignment:</label>
            <select id="assignment-select" name="assignment_id" class="form-control">
                <option value="">Choose an assignment...</option>
                <!-- Assignments will be populated via JavaScript -->
            </select>
        </div>

        <div class="form-section">
            <label for="card-count">Number of Flash Cards to Generate:</label>
            <select id="card-count" name="card_count" class="form-control">
                <option value="10">10 cards</option>
                <option value="15" selected>15 cards</option>
                <option value="20">20 cards</option>
                <option value="25">25 cards</option>
                <option value="30">30 cards</option>
            </select>
        </div>

        <div class="form-section">
            <label for="difficulty-level">Difficulty Level:</label>
            <select id="difficulty-level" name="difficulty_level" class="form-control">
                <option value="beginner">Beginner - Basic concepts and definitions</option>
                <option value="intermediate" selected>Intermediate - Detailed understanding</option>
                <option value="advanced">Advanced - Critical thinking and analysis</option>
            </select>
        </div>

        <div class="form-section">
            <label for="card-types">Flash Card Types:</label>
            <div class="checkbox-group">
                <label class="checkbox-label">
                    <input type="checkbox" name="card_types" value="definition" checked> Definitions
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" name="card_types" value="concept" checked> Concepts
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" name="card_types" value="example"> Examples
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" name="card_types" value="comparison"> Comparisons
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" name="card_types" value="application"> Applications
                </label>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">Generate Flash Cards</button>
            <button type="button" onclick="previewContent()" class="btn btn-secondary">Preview Content</button>
        </div>
    </form>

    <!-- Loading Modal -->
    <div id="loading-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="loading-spinner"></div>
            <h3>Generating Flash Cards...</h3>
            <p>AI is creating your personalized flash cards. This may take a moment.</p>
        </div>
    </div>
</div>

<style>
.header-section {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 2px solid var(--primary-color);
}

.header-section h1 {
    color: var(--primary-color);
    margin: 0;
}

.flashcard-creation-form {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    max-width: 800px;
    margin: 0 auto;
}

.form-section {
    margin-bottom: 1.5rem;
}

.form-section label {
    display: block;
    font-weight: 600;
    color: var(--primary-color);
    margin-bottom: 0.5rem;
}

.form-control {
    width: 100%;
    padding: 0.75rem;
    border: 2px solid var(--background-light);
    border-radius: 8px;
    font-size: 1rem;
    transition: border-color 0.2s ease;
}

.form-control:focus {
    outline: none;
    border-color: var(--accent-color);
}

.form-help {
    display: block;
    margin-top: 0.25rem;
    color: var(--text-muted);
    font-size: 0.9rem;
}

.checkbox-group {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 0.5rem;
    margin-top: 0.5rem;
}

.checkbox-label {
    display: flex;
    align-items: center;
    font-weight: normal !important;
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 6px;
    transition: background-color 0.2s ease;
}

.checkbox-label:hover {
    background: var(--background-light);
}

.checkbox-label input[type="checkbox"] {
    margin-right: 0.5rem;
    width: auto;
}

.form-actions {
    display: flex;
    gap: 1rem;
    justify-content: center;
    margin-top: 2rem;
    padding-top: 1rem;
    border-top: 1px solid var(--background-light);
}

.modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.7);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: 1000;
}

.modal-content {
    background: white;
    padding: 2rem;
    border-radius: 12px;
    text-align: center;
    max-width: 400px;
    width: 90%;
}

.loading-spinner {
    width: 50px;
    height: 50px;
    border: 4px solid var(--background-light);
    border-top: 4px solid var(--primary-color);
    border-radius: 50%;
    animation: spin 1s linear infinite;
    margin: 0 auto 1rem;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Dark mode support */
body.dark-mode .flashcard-creation-form,
body.dark-mode .modal-content {
    background: var(--dark-card);
    border: 1px solid var(--dark-border);
}

body.dark-mode .form-control {
    background: var(--dark-bg);
    border-color: var(--dark-border);
    color: var(--text-color);
}

body.dark-mode .checkbox-label:hover {
    background: var(--dark-bg);
}
</style>

<script>
function toggleContentInput() {
    const source = document.getElementById('content-source').value;
    const textSection = document.getElementById('text-input-section');
    const fileSection = document.getElementById('file-input-section');
    const assignmentSection = document.getElementById('assignment-input-section');
    
    // Hide all sections
    textSection.style.display = 'none';
    fileSection.style.display = 'none';
    assignmentSection.style.display = 'none';
    
    // Show selected section
    if (source === 'text') {
        textSection.style.display = 'block';
    } else if (source === 'file') {
        fileSection.style.display = 'block';
    } else if (source === 'assignment') {
        assignmentSection.style.display = 'block';
        loadAssignments();
    }
}

function loadAssignments() {
    // This would fetch assignments from the server
    // For now, we'll just show a placeholder
    const select = document.getElementById('assignment-select');
    select.innerHTML = '<option value="">Loading assignments...</option>';
    
    // In a real implementation, you'd fetch assignments here
    setTimeout(() => {
        select.innerHTML = `
            <option value="">Choose an assignment...</option>
            <option value="1">Biology Chapter 5 - Cell Structure</option>
            <option value="2">History Essay - World War II</option>
            <option value="3">Math Problem Set - Calculus</option>
        `;
    }, 1000);
}

function previewContent() {
    const source = document.getElementById('content-source').value;
    let content = '';
    
    if (source === 'text') {
        content = document.getElementById('content-text').value;
    } else if (source === 'file') {
        const file = document.getElementById('content-file').files[0];
        if (file) {
            content = `File selected: ${file.name} (${file.size} bytes)`;
        }
    } else if (source === 'assignment') {
        const assignment = document.getElementById('assignment-select').value;
        if (assignment) {
            content = `Assignment selected: ${document.getElementById('assignment-select').selectedOptions[0].text}`;
        }
    }
    
    if (content) {
        alert(`Content preview:\n\n${content.substring(0, 200)}${content.length > 200 ? '...' : ''}`);
    } else {
        alert('Please provide content to preview.');
    }
}

document.getElementById('flashcard-form').addEventListener('submit', function(e) {
    e.preventDefault();
    
    // Show loading modal
    document.getElementById('loading-modal').style.display = 'flex';
    
    // Collect form data
    const formData = new FormData(this);
    
    // Get selected card types
    const cardTypes = [];
    document.querySelectorAll('input[name="card_types"]:checked').forEach(cb => {
        cardTypes.push(cb.value);
    });
    formData.append('card_types_json', JSON.stringify(cardTypes));
    
    // Submit form
    fetch('/study-tools/api/create-flashcards', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        document.getElementById('loading-modal').style.display = 'none';
        
        if (data.success) {
            alert('Flash cards created successfully!');
            window.location.href = '/study-tools/flashcards';
        } else {
            alert(`Error: ${data.error}`);
        }
    })
    .catch(error => {
        document.getElementById('loading-modal').style.display = 'none';
        console.error('Error:', error);
        alert('An error occurred while creating flash cards. Please try again.');
    });
});
</script>
{% endblock %}
