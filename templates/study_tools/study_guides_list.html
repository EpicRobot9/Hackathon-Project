{% extends "dashboard_base.html" %}

{% block title %}Study Guides - StudyCoach{% endblock %}

{% block extra_css %}
{{ super() }}
<style>
/* Study Guides List Styles */
.study-guides-header {
    background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
    color: white;
    padding: var(--spacing-xl);
    border-radius: var(--radius-lg);
    margin-bottom: var(--spacing-xl);
    box-shadow: var(--shadow-lg);
}

.study-guides-header h1 {
    margin: 0;
    font-size: 2.25rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}

.study-guides-header p {
    margin: var(--spacing-sm) 0 0 0;
    opacity: 0.9;
    font-size: 1.1rem;
}

.header-actions {
    display: flex;
    gap: var(--spacing-sm);
    margin-top: var(--spacing-md);
}

.btn {
    padding: var(--spacing-sm) var(--spacing-lg);
    border: none;
    border-radius: var(--radius-md);
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-fast);
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-xs);
    text-decoration: none;
}

.btn-light {
    background: rgba(255, 255, 255, 0.2);
    color: white;
    border: 1px solid rgba(255, 255, 255, 0.3);
}

.btn-light:hover {
    background: rgba(255, 255, 255, 0.3);
    transform: translateY(-1px);
    color: white;
    text-decoration: none;
}

/* Filter Controls */
.filter-controls {
    background: var(--background-primary-light);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-lg);
    padding: var(--spacing-lg);
    margin-bottom: var(--spacing-xl);
}

.dark-mode .filter-controls {
    background: var(--background-primary-dark);
    border-color: var(--border-dark);
}

.filter-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: var(--spacing-md);
    align-items: end;
}

.filter-group {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}

.filter-group label {
    font-weight: 600;
    color: var(--text-primary-light);
    font-size: 0.9rem;
}

.dark-mode .filter-group label {
    color: var(--text-primary-dark);
}

.form-control, .form-select {
    padding: var(--spacing-sm);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-md);
    background: var(--background-light);
    color: var(--text-primary-light);
    font-size: 0.9rem;
    transition: all var(--transition-fast);
}

.dark-mode .form-control, .dark-mode .form-select {
    border-color: var(--border-dark);
    background: var(--background-dark);
    color: var(--text-primary-dark);
}

.form-control:focus, .form-select:focus {
    outline: none;
    border-color: #11998e;
    box-shadow: 0 0 0 2px rgba(17, 153, 142, 0.2);
}

/* Study Guides Grid */
.study-guides-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
    gap: var(--spacing-lg);
}

.study-guide-card {
    background: var(--background-primary-light);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-lg);
    padding: var(--spacing-xl);
    transition: all var(--transition-normal);
    text-decoration: none;
    color: inherit;
    position: relative;
    overflow: hidden;
}

.dark-mode .study-guide-card {
    background: var(--background-primary-dark);
    border-color: var(--border-dark);
}

.study-guide-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(90deg, #11998e, #38ef7d);
}

.study-guide-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
    text-decoration: none;
    color: inherit;
}

.guide-header {
    display: flex;
    justify-content: space-between;
    align-items: start;
    margin-bottom: var(--spacing-md);
}

.guide-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--text-primary-light);
    margin: 0;
    line-height: 1.3;
}

.dark-mode .guide-title {
    color: var(--text-primary-dark);
}

.guide-icon {
    font-size: 1.5rem;
    background: linear-gradient(135deg, #11998e, #38ef7d);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.guide-description {
    color: var(--text-secondary-light);
    margin-bottom: var(--spacing-md);
    line-height: 1.5;
}

.dark-mode .guide-description {
    color: var(--text-secondary-dark);
}

.guide-meta {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-md);
    padding: var(--spacing-md);
    background: var(--background-light);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
}

.dark-mode .guide-meta {
    background: var(--background-dark);
}

.meta-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.meta-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary-light);
}

.dark-mode .meta-value {
    color: var(--text-primary-dark);
}

.meta-label {
    color: var(--text-secondary-light);
    font-size: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.dark-mode .meta-label {
    color: var(--text-secondary-dark);
}

.guide-subject {
    display: inline-block;
    padding: var(--spacing-xs) var(--spacing-sm);
    background: linear-gradient(135deg, #11998e, #38ef7d);
    color: white;
    border-radius: var(--radius-md);
    font-size: 0.75rem;
    font-weight: 500;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.guide-actions {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: var(--spacing-md);
    padding-top: var(--spacing-md);
    border-top: 1px solid var(--border-light);
}

.dark-mode .guide-actions {
    border-top-color: var(--border-dark);
}

.last-accessed {
    font-size: 0.75rem;
    color: var(--text-secondary-light);
}

.dark-mode .last-accessed {
    color: var(--text-secondary-dark);
}

.action-buttons {
    display: flex;
    gap: var(--spacing-xs);
}

.btn-sm {
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: 0.75rem;
    border-radius: var(--radius-sm);
}

.btn-primary {
    background: #11998e;
    color: white;
    border: none;
}

.btn-primary:hover {
    background: #0e8074;
    transform: translateY(-1px);
}

.btn-outline-primary {
    background: transparent;
    color: #11998e;
    border: 1px solid #11998e;
}

.btn-outline-primary:hover {
    background: #11998e;
    color: white;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: var(--spacing-xl) var(--spacing-lg);
    color: var(--text-secondary-light);
    background: var(--background-primary-light);
    border: 1px solid var(--border-light);
    border-radius: var(--radius-lg);
}

.dark-mode .empty-state {
    color: var(--text-secondary-dark);
    background: var(--background-primary-dark);
    border-color: var(--border-dark);
}

.empty-state i {
    font-size: 4rem;
    margin-bottom: var(--spacing-lg);
    opacity: 0.5;
    background: linear-gradient(135deg, #11998e, #38ef7d);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.empty-state h3 {
    margin-bottom: var(--spacing-sm);
    color: var(--text-primary-light);
}

.dark-mode .empty-state h3 {
    color: var(--text-primary-dark);
}

.empty-state .btn {
    margin-top: var(--spacing-md);
}

/* Responsive Design */
@media (max-width: 768px) {
    .study-guides-header h1 {
        font-size: 1.75rem;
    }
    
    .header-actions {
        flex-direction: column;
    }
    
    .filter-grid {
        grid-template-columns: 1fr;
    }
    
    .study-guides-grid {
        grid-template-columns: 1fr;
    }
    
    .guide-meta {
        grid-template-columns: repeat(2, 1fr);
        gap: var(--spacing-sm);
    }
    
    .guide-actions {
        flex-direction: column;
        gap: var(--spacing-sm);
        align-items: stretch;
    }
    
    .action-buttons {
        justify-content: center;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Study Guides Header -->
    <div class="study-guides-header">
        <h1>
            <i class="fas fa-book-open"></i>
            My Study Guides
        </h1>
        <p>AI-generated study guides to help you master any subject efficiently</p>
        
        <div class="header-actions">
            <a href="{{ url_for('study_tools.create_study_guide') }}" class="btn btn-light">
                <i class="fas fa-plus"></i>
                Create New Guide
            </a>
            <a href="{{ url_for('study_tools.study_tools_dashboard') }}" class="btn btn-light">
                <i class="fas fa-arrow-left"></i>
                Back to Dashboard
            </a>
        </div>
    </div>

    <!-- Filter Controls -->
    <div class="filter-controls">
        <div class="filter-grid">
            <div class="filter-group">
                <label for="subjectFilter">
                    <i class="fas fa-book"></i> Subject
                </label>
                <select id="subjectFilter" class="form-select" onchange="applyFilters()">
                    <option value="">All Subjects</option>
                    <option value="Mathematics">Mathematics</option>
                    <option value="Science">Science</option>
                    <option value="History">History</option>
                    <option value="Literature">Literature</option>
                    <option value="Languages">Languages</option>
                    <option value="Geography">Geography</option>
                    <option value="Computer Science">Computer Science</option>
                    <option value="Psychology">Psychology</option>
                    <option value="Art">Art</option>
                    <option value="Music">Music</option>
                    <option value="General">General</option>
                    <option value="Other">Other</option>
                </select>
            </div>
            
            <div class="filter-group">
                <label for="searchFilter">
                    <i class="fas fa-search"></i> Search
                </label>
                <input type="text" id="searchFilter" class="form-control" 
                       placeholder="Search by title..." onkeyup="applyFilters()">
            </div>
            
            <div class="filter-group">
                <label for="sortBy">
                    <i class="fas fa-sort"></i> Sort By
                </label>
                <select id="sortBy" class="form-select" onchange="applyFilters()">
                    <option value="recent">Most Recent</option>
                    <option value="title">Title A-Z</option>
                    <option value="subject">Subject</option>
                    <option value="accessed">Last Accessed</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Study Guides -->
    {% if study_guides %}
    <div class="study-guides-grid" id="studyGuidesGrid">
        {% for guide in study_guides %}
        <div class="study-guide-card" 
             data-subject="{{ guide.subject }}" 
             data-title="{{ guide.title.lower() }}">
            
            <div class="guide-header">
                <h3 class="guide-title">{{ guide.title }}</h3>
                <div class="guide-icon">
                    <i class="fas fa-file-alt"></i>
                </div>
            </div>
            
            {% if guide.description %}
            <p class="guide-description">{{ guide.description[:150] }}{% if guide.description|length > 150 %}...{% endif %}</p>
            {% endif %}
            
            <div class="guide-meta">
                <div class="meta-item">
                    <div class="meta-value">{{ "%.1f"|format(guide.content_length / 1000) }}K</div>
                    <div class="meta-label">Characters</div>
                </div>
                <div class="meta-item">
                    <div class="meta-value">{{ guide.created_at[:10] }}</div>
                    <div class="meta-label">Created</div>
                </div>
            </div>
            
            <div class="guide-subject">{{ guide.subject }}</div>
            
            <div class="guide-actions">
                <div class="last-accessed">
                    Last accessed: {{ guide.last_accessed if guide.last_accessed != 'Never' else 'Never accessed' }}
                </div>
                <div class="action-buttons">
                    <a href="{{ url_for('study_tools.view_study_guide', guide_id=guide.id) }}" 
                       class="btn btn-sm btn-primary">
                        <i class="fas fa-eye"></i>
                        View
                    </a>
                    <a href="{{ url_for('study_tools.export_study_guide_pdf', guide_id=guide.id) }}" 
                       class="btn btn-sm btn-outline-primary">
                        <i class="fas fa-download"></i>
                        PDF
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <!-- Empty State -->
    <div class="empty-state">
        <i class="fas fa-book-open"></i>
        <h3>No Study Guides Yet</h3>
        <p>Create your first AI-generated study guide from your class materials.</p>
        <a href="{{ url_for('study_tools.create_study_guide') }}" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            Create Your First Guide
        </a>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script>
// Filter and search functionality
function applyFilters() {
    const subjectFilter = document.getElementById('subjectFilter').value.toLowerCase();
    const searchFilter = document.getElementById('searchFilter').value.toLowerCase();
    const sortBy = document.getElementById('sortBy').value;
    
    const cards = Array.from(document.querySelectorAll('.study-guide-card'));
    
    // Filter cards
    const filteredCards = cards.filter(card => {
        const subject = card.dataset.subject.toLowerCase();
        const title = card.dataset.title;
        
        // Subject filter
        if (subjectFilter && !subject.includes(subjectFilter)) {
            return false;
        }
        
        // Search filter
        if (searchFilter && !title.includes(searchFilter)) {
            return false;
        }
        
        return true;
    });
    
    // Sort cards
    filteredCards.sort((a, b) => {
        switch (sortBy) {
            case 'title':
                return a.dataset.title.localeCompare(b.dataset.title);
            case 'subject':
                return a.dataset.subject.localeCompare(b.dataset.subject);
            case 'accessed':
                // This would need additional data attributes for proper sorting
                return 0;
            case 'recent':
            default:
                return 0; // Keep original order for recent
        }
    });
    
    // Hide all cards first
    cards.forEach(card => {
        card.style.display = 'none';
    });
    
    // Show filtered and sorted cards
    filteredCards.forEach(card => {
        card.style.display = 'block';
    });
    
    // Show empty state if no cards match
    const grid = document.getElementById('studyGuidesGrid');
    if (filteredCards.length === 0 && cards.length > 0) {
        if (!document.getElementById('noResults')) {
            const noResults = document.createElement('div');
            noResults.id = 'noResults';
            noResults.className = 'empty-state';
            noResults.innerHTML = `
                <i class="fas fa-search"></i>
                <h3>No Matching Study Guides</h3>
                <p>Try adjusting your filters or search terms.</p>
                <button class="btn btn-primary" onclick="clearFilters()">
                    <i class="fas fa-times"></i>
                    Clear Filters
                </button>
            `;
            grid.parentNode.insertBefore(noResults, grid.nextSibling);
        }
        document.getElementById('noResults').style.display = 'block';
    } else {
        const noResults = document.getElementById('noResults');
        if (noResults) {
            noResults.style.display = 'none';
        }
    }
}

function clearFilters() {
    document.getElementById('subjectFilter').value = '';
    document.getElementById('searchFilter').value = '';
    document.getElementById('sortBy').value = 'recent';
    applyFilters();
}

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    // Apply initial sort
    applyFilters();
});
</script>
{% endblock %}
